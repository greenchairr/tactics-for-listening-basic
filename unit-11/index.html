
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 11: Entertainment - Interactive Lesson</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 0; display: flex; justify-content: center; }
        
        /* Mobile Responsive Container */
        .container { width: 100%; max-width: 650px; background: white; min-height: 100vh; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        /* Tabs Styling */
        .tabs { display: flex; background: var(--primary); position: sticky; top: 0; z-index: 100; }
        .tab-btn { flex: 1; padding: 15px 5px; border: none; background: none; color: white; cursor: pointer; font-weight: bold; font-size: 0.85rem; transition: 0.3s; opacity: 0.6; }
        .tab-btn.active { opacity: 1; border-bottom: 4px solid var(--secondary); background: rgba(255,255,255,0.1); }
        
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* General UI */
        h2 { font-size: 1.1rem; color: var(--primary); margin-bottom: 20px; border-left: 5px solid var(--secondary); padding-left: 10px; text-transform: uppercase; }
        .item-row { margin-bottom: 18px; padding-bottom: 10px; border-bottom: 1px solid #f1f1f1; }
        .label-vn { font-weight: 600; color: #555; display: block; margin-bottom: 5px; }
        
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; box-sizing: border-box; font-size: 1rem; transition: 0.3s; }
        input[type="text"]:focus { border-color: var(--secondary); background: #fdfdfd; }
        
        .correct-ans { color: var(--danger); font-size: 0.9rem; font-weight: bold; margin-top: 5px; display: none; }
        .inline-ans { color: var(--danger); font-weight: bold; font-size: 0.9rem; display: none; }

        /* Buttons */
        .verify-btn { width: 100%; padding: 15px; border: none; border-radius: 10px; background: var(--success); color: white; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .verify-btn:active { transform: scale(0.98); }

        /* Speaking Section */
        .speaking-card { background: #f8fbff; border: 1px solid #e1e8f0; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .sentence-text { font-size: 1.1rem; color: #2c3e50; font-weight: 500; margin-bottom: 15px; display: block; }
        .action-btns { display: flex; gap: 10px; }
        .btn-speak { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-tts { background: var(--secondary); }
        .btn-record { background: var(--danger); }
        .recording { animation: pulse 1.2s infinite; background: #c0392b !important; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        
        audio { width: 100%; margin-top: 15px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <a href="../index.html" class="tab-btn" style="flex: 0.5; background: rgba(0,0,0,0.2); text-decoration: none; display: flex; align-items: center; justify-content: center;">üè† Home</a>
        <button class="tab-btn active" onclick="openTab(event, 'part1')">1. VOCAB</button>
        <button class="tab-btn" onclick="openTab(event, 'part2')">2. LISTEN</button>
        <button class="tab-btn" onclick="openTab(event, 'part3')">3. SPEAK</button>
    </div>
    

    <div id="part1" class="tab-content active">
        <h2>Vocabulary Recall</h2>
        <p style="color: #7f8c8d; font-size: 0.9rem;"><i>Nh√¨n nghƒ©a ti·∫øng Vi·ªát, vi·∫øt t·ª´ ti·∫øng Anh t∆∞∆°ng ·ª©ng:</i></p>
        <div id="vocab-container"></div>
        <button class="verify-btn" onclick="verifyVocab()">VERIFY VOCABULARY</button>
    </div>

    <div id="part2" class="tab-content">
        <h2>Listening & Fill in Blanks</h2>
        <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <p style="margin:0 0 10px 0; font-weight:bold;">Audio Lesson:</p>
            <audio controls>
                <source src="unit11_audio.mp3" type="audio/mpeg">
                Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ audio.
            </audio>
        </div>
        <div id="listening-container" style="line-height: 2.2; text-align: justify;"></div>
        <button class="verify-btn" onclick="verifyListen()">VERIFY LISTENING</button>
    </div>

    <div id="part3" class="tab-content">
        <h2>Speaking Practice</h2>
        <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px;"><i>Nghe m√°y ƒë·ªçc m·∫´u sau ƒë√≥ nh·∫•n Record ƒë·ªÉ luy·ªán t·∫≠p:</i></p>
        <div id="speaking-container"></div>
    </div>
</div>

<script>
    // --- DATA CONFIGURATION ---
    const vocabData = [
        { vn: "H√†nh ƒë·ªông", en: "action" }, { vn: "Tr∆∞·ª£t patin", en: "rollerblading" },
        { vn: "D√£ ngo·∫°i", en: "picnic" }, { vn: "C·ªët truy·ªán", en: "story" },
        { vn: "T·∫≠p th·ªÉ d·ª•c", en: "exercise" }, { vn: "Tr·∫≠n ƒë·∫•u / Tr√≤ ch∆°i", en: "game" },
        { vn: "ƒêi b∆°i", en: "swimming" }, { vn: "C√°t", en: "sand" },
        { vn: "Qu·∫ßn jeans", en: "jeans" }, { vn: "√Åo s∆° mi", en: "shirts" }
    ];

    const listenDialogues = [
        "<b>D1:</b> My friend said the (1) [story] is great. It‚Äôs full of (2) [action].",
        "<b>D2:</b> Perfect for (3) [swimming]. I just want to lie on the (4) [sand] and (5) [sleep].",
        "<b>D3:</b> What time is the (6) [game]? Are you (7) [playing]?",
        "<b>D4:</b> What to do this (8) [weekend]? Let's get the guys and go (9) [rollerblading].",
        "<b>D5:</b> I need some new (10) [jeans] and (11) [shirts].",
        "<b>D6:</b> It's great (12) [exercise]. Let's have a (13) [picnic] in the park."
    ];

    const speakSentences = [
        "This weekend, I want to go swimming and watch an action movie.",
        "The story of this movie is great and it is full of action.",
        "I need to buy some new jeans and shirts on Saturday afternoon.",
        "Let's get the guys and go rollerblading in the park.",
        "It's great exercise, so maybe we can have a picnic there."
    ];

    // --- TAB LOGIC ---
    function openTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
        window.scrollTo(0, 0);
    }

    // --- PART 1 SETUP ---
    const vContainer = document.getElementById('vocab-container');
    vocabData.forEach((v, i) => {
        vContainer.innerHTML += `
            <div class="item-row">
                <span class="label-vn">${i+1}. ${v.vn}:</span>
                <input type="text" id="v-input-${i}" placeholder="...">
                <div class="correct-ans" id="v-ans-${i}">Correct: ${v.en}</div>
            </div>`;
    });

    // --- PART 2 SETUP ---
    const lContainer = document.getElementById('listening-container');
    let qIdx = 1;
    listenDialogues.forEach((text) => {
        let processed = text.replace(/\[(.*?)\]/g, (match, p1) => {
            let html = `<input type="text" id="q-input-${qIdx}" style="width:90px; padding:5px; height:30px"> <span class="inline-ans" id="q-ans-${qIdx}"></span>`;
            qIdx++;
            return html;
        });
        lContainer.innerHTML += `<div style="margin-bottom:20px">${processed}</div>`;
    });

    // --- PART 3 SETUP ---
    const sContainer = document.getElementById('speaking-container');
    speakSentences.forEach((s, i) => {
        sContainer.innerHTML += `
            <div class="speaking-card">
                <span class="sentence-text" id="text-${i}">${s}</span>
                <div class="action-btns">
                    <button class="btn-speak btn-tts" onclick="playTTS(${i})">üîä Listen</button>
                    <button class="btn-speak btn-record" id="rec-btn-${i}" onclick="toggleRecord(${i})">üé§ Record</button>
                </div>
                <audio id="audio-out-${i}" controls style="display:none"></audio>
            </div>`;
    });

    // --- LOGIC FUNCTIONS ---
    function verifyVocab() {
        vocabData.forEach((v, i) => {
            const input = document.getElementById(`v-input-${i}`);
            const ans = document.getElementById(`v-ans-${i}`);
            if (input.value.toLowerCase().trim() !== v.en) {
                ans.style.display = 'block';
                input.style.borderColor = 'var(--danger)';
            } else {
                ans.style.display = 'none';
                input.style.borderColor = 'var(--success)';
            }
        });
    }

    function verifyListen() {
        const answers = ["story", "action", "swimming", "sand", "sleep", "game", "playing", "weekend", "rollerblading", "jeans", "shirts", "exercise", "picnic"];
        answers.forEach((a, i) => {
            const id = i + 1;
            const input = document.getElementById(`q-input-${id}`);
            const ans = document.getElementById(`q-ans-${id}`);
            if (input.value.toLowerCase().trim() !== a) {
                ans.innerHTML = `(${a})`;
                ans.style.display = 'inline';
                input.style.borderColor = 'var(--danger)';
            } else {
                ans.style.display = 'none';
                input.style.borderColor = 'var(--success)';
            }
        });
    }

    function playTTS(id) {
        window.speechSynthesis.cancel();
        const text = document.getElementById(`text-${id}`).innerText;
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        msg.rate = 0.85; 
        window.speechSynthesis.speak(msg);
    }

    let mediaRecorder;
    let chunks = [];
    async function toggleRecord(id) {
        const btn = document.getElementById(`rec-btn-${id}`);
        if (!mediaRecorder || mediaRecorder.state === 'inactive') {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            chunks = [];
            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/wav' });
                const player = document.getElementById(`audio-out-${id}`);
                player.src = URL.createObjectURL(blob);
                player.style.display = 'block';
            };
            mediaRecorder.start();
            btn.innerHTML = "‚èπ Stop";
            btn.classList.add('recording');
        } else {
            mediaRecorder.stop();
            btn.innerHTML = "üé§ Record";
            btn.classList.remove('recording');
        }
    }
</script>

</body>
</html>
